+++
date = "2017-09-14T08:00:00"
title = "魚眼中的世界是什麼樣的？這種神奇鏡頭會告訴你一切"
titleimage = "https://pic3.zhimg.com/v2-064d2ed8ac07a6c3323a463b7c72599e.jpg"
ga = 091408
+++

<div class="main-wrap content-wrap">
<div class="headline">

<div class="img-place-holder"></div>



</div>

<div class="content-inner">



<div class="question">
<h2 class="question-title">魚眼鏡頭是怎麼「魚眼」的？</h2>
<div class="answer">



<div class="content">
<p>喜歡攝影的朋友們大概都聽過魚眼鏡頭這個名字，往往對這種鏡頭感覺又愛又恨。愛他及其廣闊的視角，又恨他不受控制的扭曲變形。這篇文章裏，我們來好好聊一聊這個讓攝影師又愛又恨的神奇鏡頭吧。</p>
<p><strong>1 從針孔到凸透鏡</strong></p>
<p>從幾萬年前的原始人類開始，人們就一直想要把看到的景象記錄下來。最開始在岩石上用礦物粉末作畫，後來在紙、布上用筆墨作畫。在很長一段時間內，人們總是在追求描摹得更真實，在這個過程中，人們逐漸學習到了各種光學現象，總結出很多光學的規律，並將之應用於實踐，於是製造出了最早的相機&mdash;&mdash;針孔相機。</p>
<p>針孔相機是利用小孔成像原理，將外部的景物經由小孔，成像在相機的成像平面上（有關針孔相機的一些詳細計算和有趣討論，參見之前的專欄文章<a class="internal" href="https://zhuanlan.zhihu.com/p/24433830">《針孔相機與昆蟲複眼》</a>）。在一開始甚至沒有用於記錄影像的材料，人們便在這個成像平面上依照影像來作畫，來描摹出更真實的場景。（圖片來自 WiKi <a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.wikiwand.com/en/Camera_obscura" target="_blank" rel="nofollow noreferrer">Camera obscura</a>）</p>
<img class="content-image" src="https://pic2.zhimg.com/v2-4ee57d7a03fc76df570573353b33e3d9_b.jpg" alt="">
<p>（使用針孔相機進行描摹）</p>
<p>針孔相機的針孔，就可以看做最早的鏡頭了，可惜這個「鏡頭」性能實在不能滿足要求。針孔相機若要成像清晰，針孔的大小就必然不大（參見之前文章中的計算和討論），經由針孔進入相機的光線也是少的可憐；即使如此，在成像平面上的像也不是那麼清晰。直到後來，人類發明了凸透鏡，利用凸透鏡成像，取代小孔，成爲相機真正意義上的鏡頭。凸透鏡做鏡頭有着顯而易見的好處。凸透鏡可以做得比小孔大的多，從而進入相機的光線也多的多，落在相機成像平面上的像自然也明亮的多了。此外凸透鏡成像的清晰度可比小孔要高多了，而且不會明顯受到透鏡大小的影響。 （圖片來自 WiKi <a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.wikiwand.com/en/Camera_obscura" target="_blank" rel="nofollow noreferrer">Camera obscura</a>）</p>
<img class="content-image" src="https://pic4.zhimg.com/v2-68e550dcf0744e47d4cfa1fce55481cf_b.jpg" alt="">
<p>（使用凸透鏡（鏡頭）進行描摹）</p>
<p>用凸透鏡做鏡頭，儘管形式改了，但是成像投影的方式並沒有變化，都可以用同樣的數學來進行描述。所以，現在很多計算機圖形學中，對相機的簡單建模，仍然用針孔相機來表示。在這個簡單的「針孔相機」 模型中，像與物之間是「相似」的，或者更嚴格地用數學語言來說，像與物之間是經過了「射影變換（Perspective Transform）」（在以前的專欄文章<a class="internal" href="https://zhuanlan.zhihu.com/p/25030168">《移軸攝影、沙姆定律與射影幾何》</a> 和 <a class="internal" href="https://zhuanlan.zhihu.com/p/25311770">《星野攝影降噪（2）：對齊疊加》</a>中都有提到射影變換），在射影變換下，像與物之間保持了某些相似的特性，比如直線經過變換仍然是直線，圓錐曲線（比如橢圓）經過變換仍然是圓錐曲線，兩直線的交點經過變換仍然是兩直線相交的點，直線的交比經過變換保持不變，等等。正因爲射影變換保持了很多幾何性質不變，所以我們看照片，是能夠與原場景聯繫起來的，照片與原場景之間存在某些相似性。</p>
<img class="content-image" src="https://pic2.zhimg.com/v2-b5e15bfb7472a9e6089878e1d75c8fc9_b.png" alt="">
<p>（針孔相機模型）</p>
<p>從這個角度來看，相機鏡頭起的作用，就是做了一個數學變換，把物空間變換成了像空間，然後成像平面在這個像空間內切了一刀，截取了一個平面，成爲拍下的照片。在不同場合下，許多稱呼包括普通鏡頭（Normal lens）、射影鏡頭（Perspective lens）、線性鏡頭（Linear lens）、針孔相機模型（Pinhole camera model）等，均指代這種，遵從射影變換的相機 / 鏡頭模型。（圖片來自 <a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.scratchapixel.com/lessons/3d-basic-rendering/3d-viewing-pinhole-camera" target="_blank" rel="nofollow noreferrer">Scratchapixel</a>）</p>
<p><strong>2 魚眼與魚眼鏡頭</strong></p>
<p>對日常生活、甚至一些藝術創作、科學研究來說，保持像與物的相似是一件好事。偏離相似性，我們就說鏡頭有了畸變，大多數時候，我們並不希望鏡頭有畸變，甚至在設計鏡頭的時候，專門針對「偏離相似性」&mdash;&mdash;也就是鏡頭畸變進行校正。不過在一些特殊的場合，我們也需要特意偏離物像的相似性，以求得其他方面的便利。</p>
<p>一個極好的例子是氣象科學中，對天空雲量的測量。在這個場景中，人們希望能夠獲得儘可能大的視野範圍，最好是直接把整個天空一次性拍攝下來&mdash;&mdash;這就要求鏡頭能夠達到 180&deg; 的視場角。容易想到，我們可以把天空和雲看做分佈於一個半徑無窮大的球面上，也就是說，我們要把一個（半）球面的場景儘可能全地記錄、拍攝下來。普通的超廣角鏡頭難以完成這樣的任務。</p>
<img class="content-image" src="https://pic3.zhimg.com/v2-7bea998a4f3967c61908b4787d941a46_b.png" alt="">
<p>（普通鏡頭無法記錄完整的半球場景）</p>
<p>如圖所示，面對半球場景，普通的超廣角鏡頭只能記錄中間的部分，越靠近邊緣，透視變形越大。圖中同樣長度的紅色箭頭，靠近邊緣的話，經過鏡頭成像之後就變得更長；對於極端接近邊緣的物體，普通的廣角鏡頭是無法成像記錄的。這種情況下，追求「相似性」反而成爲了障礙。</p>
<p>既然追求「相似性」的普通鏡頭難以勝任這樣的任務場景，那麼我們放棄相似性是不是就可以完成任務了呢？比如，對於靠近邊緣的光線，我們不再要求他繼續保持出射角與入射角相等，而是彎折一些，這樣不就可以記錄更大的視角範圍了嗎？而且物體的長度也不至於被拉伸得很厲害。</p>
<p>人們想到了水下的魚。由於水的折射率比空氣大，光線從空氣進入水中，折射角比入射角更小，並且入射角越大，這個變小的程度也越大。這正好是我們所需要的特性。由於這個特性，使得水下的魚在向上看的時候，能一眼看到整個水面上的這個半球形空間；這整個空間的影像，都被「扭曲」、「壓縮」到了一個半頂角約爲 48&deg; 的錐形內。</p>
<img class="content-image" src="https://pic3.zhimg.com/v2-99a46c19c3c9ff6c962a1ae7922233a2_b.png" alt="">
<p>（空氣 - 水界面處的光線折射與全反射）</p>
<p>在這個錐形空間內部，是來自水面上的空間的光線，在這個錐形外部，是來自水面下景色的反射。也就是說，在水下向上看，在一個圈之外，只能看到水底的景色；所有水面上的景色，都被壓縮在一個圈內。這個圈，也叫「斯涅耳窗口（<a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.wikiwand.com/en/Snell%2527s_window" target="_blank" rel="nofollow noreferrer">Snell's window</a>）」 （圖片來自 <a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.wikiwand.com/en/Snell%2527s_window" target="_blank" rel="nofollow noreferrer">Snell's window</a>）。</p>
<img class="content-image" src="https://pic2.zhimg.com/v2-e6b3001a8d9b4fd1e12e1715b89d3d65_b.jpg" alt="">
<p>（斯涅耳窗口現象）</p>
<p>上圖就是典型的斯涅耳窗口現象，從水下向上看，只有一個圈內是亮的（來自水面上方的光線），在圈外是暗色的水底的反射。我們可以想象，如果水面平靜沒有漣漪，那麼這個圈內是可以看到水面上空間的景物的。如果這樣拍一張照片，就可以在一個合理的照片大小範圍內，記錄整個水面上的半球空間內的景象。有效的視角範圍接近 180&deg;，遠遠超過普通超廣角鏡頭記錄的範圍。</p>
<p>正因爲從水中向上看有這樣奇妙的特性，人們受此啓發，製造了魚眼鏡頭。魚眼鏡頭與這個場景類似，也是把很大角度範圍內的光線進行「壓縮」和「扭曲」，壓進一個相對較小的空間內，從而可以被相機所記錄下來。從這個角度可以說，魚眼鏡頭是受到魚眼看到的景象的啓發而發明的，這也是魚眼鏡頭這個名字的來歷。當然，魚眼鏡頭的前鏡組大多具有一個極凸的鏡片表面，看起來外形上也讓人聯想到魚的眼睛，魚眼鏡頭這個名字可以說也是非常貼切了。</p>
<p><strong>3 魚眼鏡頭的投影方式</strong></p>
<p>我們已經知道，從數學上來說，普通的鏡頭成像相當於進行了一次射影變換。那麼魚眼鏡頭是一個什麼變換呢？我們來看看，魚眼鏡頭的變換，需要有什麼樣的特性。</p>
<p>首先當然是視角要大。或者說，對於某一個入射角，經過鏡頭之後射向成像面的出射角，一定是要小於入射角的。否則沒辦法在一個相對較小的範圍內記錄極大的視角。</p>
<p>第二，最好這個變換有比較良好的性質。這一點比較模糊，什麼叫「良好的性質」？比如說普通鏡頭對應的射影變換，就有良好的性質，經過射影變換後，很多幾何特徵能保持不變，直線還是直線、圓錐曲線還是圓錐曲線。我們希望魚眼鏡頭對應的這個變換，也能夠保持一些幾何特徵不變。比如，變換前後，圓還是圓；比如，變換前後，一塊空間所佔的立體角不變。</p>
<p>第三，最好這個變換的形式比較簡單。簡單的形式方便讓人從成像中直接觀測、推斷，而不用經過複雜的運算才能看出拍的是個什麼東西。</p>
<p>我們來看看，滿足這三個條件的情況下，魚眼鏡頭可以有什麼樣的變換形式（我們把這種變換叫做投影，Projection）。爲了直觀地感受不同投影方式帶來的差異，我寫了一個簡單的圖形渲染器。受到 WiKi <a class=" wrap external" href="http://link.zhihu.com/?target=https%3A//www.wikiwand.com/en/Fisheye_lens" target="_blank" rel="nofollow noreferrer">Fisheye lens</a> 中的場景啓發，我設置了一個差不多的場景，是一個直筒型的管道，管道壁上有規則的顏色格子。在這個場景中用不同的投影方式去模擬魚眼鏡頭拍攝的圖像，以便讓大家有一個直觀的感受。</p>
<img class="content-image" src="https://pic4.zhimg.com/v2-d87844d12bb2ee4f18d40db2280dd54b_b.png" alt="">
<p>（模擬場景管道內，普通 14mm 超廣角不同視角拍攝的效果，沒看明白這個場景的可以看文末彩蛋的動畫演示）</p>
<ul>
<li>斯涅耳窗投影，也就是真的去模仿水下魚類向上看的時候的場景，我把這個投影方式叫做斯涅耳窗投影。用公式表達出射角和入射角之間的關係是 &theta;&prime;=sin&minus;1⁡(sin⁡&theta;/n)，其中 &theta; 是入射角，&theta;&prime; 是出射角，n 是水的折射率。很顯然，這種投影方式最大的視角不會超過 180&deg;。這種投影方式沒什麼特別的用處，在這裏也只是作爲最初的起點。現實中我從來沒見哪個魚眼鏡頭是用這種投影方式的。</li>
</ul>
<img class="content-image" src="https://pic1.zhimg.com/v2-971f9e724c1c29c523f0138ba77e23f0_b.png" alt="">
<p>（斯涅耳窗投影效果）</p>
<ul>
<li>等積投影（Equisolid angle，equal area），也叫等立體角投影。用公式表達物體成像後與畫面中心的距離 r 與入射角 &theta; 之間的關係就是 r=2fsin⁡(&theta;/2)。這種投影方式的特徵在於，能保持變換前後，物體所佔的立體角大小不變。或者說，在半球形空間中，半球面上兩個「面積」相同的圖案，成像後，在成像平面上的兩個圖案的面積仍然相同（雖然兩者形狀不一定相似）。這正是這個投影方式名字的由來。這種特性使得這個投影方式被廣泛應用，其中一種場合就是測量全天雲量覆蓋情況。整個天空中雲量覆蓋多少，是由雲所佔的空間立體角的比例決定的。用這種投影方式的鏡頭，直接對着天空拍一張，在照片中測量一下雲所佔的像素面積比例，就得到了全天雲量覆蓋情況。在下圖的模擬場景中，圓筒壁上每一列的各個小方格的面積都是相等的。</li>
</ul>
<img class="content-image" src="https://pic3.zhimg.com/v2-22ca8a1c564fc794b5fc1717e1a606ae_b.png" alt="">
<p>（等積投影效果）</p>
<ul>
<li>等距投影（Equidistance，linear scaled）。這種投影方式的特點是，物體在成像面上離開畫面中心的距離，與物體在空間中離開光軸的角度成正比，這個比例係數就是鏡頭焦距。用公式表達這個距離與角度的關係就是 r=f&theta;，其中 r 就是物體的像到畫面中心的距離，就是入射角，也等於物體在空間中離開光軸的角度。在這種投影變換下，物體離開中心的距離（角度）就是一個重要的幾何性質，物體的空間角距離與物體的像在像平面上的平面距離，是成正比的。這也是這個投影方式名稱的來源。這種方式的鏡頭較少，然而更多地用在軍事領域。想像一下武器瞄準系統，使用這種投影方式的鏡頭，不僅監測的視野範圍大，而且對於目標的方位角度，只要直接在畫面裏測量平面距離就可以了，非常方便。在下圖的模擬場景中，中間一列的各個小方格的高度都是一樣的。</li>
</ul>
<img class="content-image" src="https://pic4.zhimg.com/v2-74dfc587a47c971692dab2b989846d1b_b.png" alt="">
<p>（等距投影效果）</p>
<ul>
<li>體視投影（Stereographic，conform）。用公式表達就是 r=2ftan⁡(&theta;/2)，其中各個符號含義同前。這種投影方式的特點是能保持角度不變，這在數學上是一個非常良好的性質，叫做「保角變換（Conform）」，數學中有關保角變換的研究，可以整整寫出好幾本書，這裏就不再展開更多了。保持角度不變，意思是任何直線相交的角度，在變換之後是保持不變的（雖然直線本身可能變彎曲）。在保角變換下，一個圓仍然還是一個圓（直線可以看做直徑無窮大的圓），所以在某種程度上，保角變換也是保持了「形狀」不變的。在下面的模擬場景中，圓筒壁上的所有邊界線，全部都變成了圓弧；所有線的交角，也都保持了 90&deg; 不變。</li>
</ul>
<img class="content-image" src="https://pic3.zhimg.com/v2-7dd8aa324c0b026b892c1267829f9a12_b.png" alt="">
<p>（體視投影效果）</p>
<ul>
<li>正交投影（Orthographic）。這種投影方式，就像是把整個半球直接拍扁，用公式表達就是 r=sin⁡(&theta;)。在幾種投影方式中，這種投影方式帶來的扭曲最大，對邊緣物體壓縮最厲害，實際很少使用。很顯然，這種投影方式的最大視場角也不能大於 180&deg;。</li>
</ul>
<img class="content-image" src="https://pic1.zhimg.com/v2-1e58bf3c2097a67afc669fd9cc5cacfc_b.png" alt="">
<p>（正交投影效果）</p>
<p>在實際的商品化的民用鏡頭中，等積投影和等距投影都有不少使用，尤其在科研領域，相對的體視投影的鏡頭較少，不過也因爲這種投影變形較小，還能保持角度不變，使得這種投影方式的鏡頭擁有相當多的愛好者。</p>
<p>從上面的分析中可以看到，魚眼鏡頭的視場角與焦距之間並不是一個固定的關係，而是和鏡頭所選擇的投影方式密切相關。不同的鏡頭可能選擇不同的投影方式，所以在購買和使用的過程中，不能夠僅僅依據焦距來判斷鏡頭的視角。我在一個很早的回答 <a class="internal" href="https://www.zhihu.com/question/20550154/answer/15466221">《爲什麼不同焦距的魚眼鏡頭可以達到同樣的視角？》</a> 中也提到過這個現象。</p>
<p><strong>4 總結</strong></p>
<ol>
<li>普通鏡頭和針孔相機在數學模型上可以等價對待，都是射影變換（Perspective transform）；</li>
<li>魚眼鏡頭受到水下斯涅耳窗口現象的啓發，採用不同的投影方式，來得到極大的視場角；</li>
<li>魚眼鏡頭常用的投影方式包括等距投影、等積投影、體視投影、正交投影等；</li>
</ol><hr>
<p><strong>彩蛋</strong></p>
<p>我用自己寫的簡單渲染器渲染了一段動畫，來形象地展示不同鏡頭拍攝的變形效果。（爲了表現空間感，我特意加了一層霧霾效果，看起來是不是比較有層次了？）</p>
<p><img class="content-image" src="https://pic1.zhimg.com/v2-974712c0daee4c081f063550c264d828.jpg" alt=""></p>
<p>（這是普通的 14mm 超廣角鏡頭拍攝的效果）</p>
<p><img class="content-image" src="https://pic2.zhimg.com/v2-10b4163e034a63790c513cfece653a6d.jpg" alt=""></p>
<p>（這是等積投影（Equisolid）的魚眼鏡頭拍攝的效果）</p>
<p><img class="content-image" src="https://pic4.zhimg.com/v2-d17f18335cb5267c2662ceec37e3b9c3.jpg" alt=""></p>
<p>（這是等距投影（Equidistance）的魚眼鏡頭拍攝的效果）</p>
<p><img class="content-image" src="https://pic4.zhimg.com/v2-951e32325a775d5594e4723cf8f86c13.jpg" alt=""></p>
<p>（這是體視投影（Stereographic）的魚眼鏡頭拍攝的效果）</p>



</div>
</div>
</div>


</div>
</div>